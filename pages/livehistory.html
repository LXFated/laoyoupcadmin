<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/reset.css">
  <link rel="stylesheet" href="../css/livehistory.css">
  <link rel="stylesheet" href="../css/pagination.css">
  <script src="../js/jquery1.11.1.min.js"></script>
  <script src="../js/jquery.pagination.js"></script>
  <script src="../js/jquery.cookie.js"></script>
  <script src="../js/url.js"></script>
  <title>Document</title>
</head>

<body>
  <div class="header-wrap">
    <div class="header">
      <img src="../img/top_logo@2x.png" alt="" class="logo">
      <div class="nav">
        <a href="livepre.html">直播预告</a>
        <a href="livemanage.html" class="active">直播管理</a>
      </div>
      <div class="right">
        <div class="nick">
          <img src="" alt="">
          <p></p>
        </div>
        <span onclick="loginout()">退出登录</span>

      </div>
    </div>

  </div>
  <div class="main">
    <div class="content">
      <div class="title">

      </div>
      <div class="info">
        <div class="single">
          <span>标题：</span>
          <p></p>
        </div>
        <div class="single">
          <span>简介：</span>
          <strong>

          </strong>
        </div>
        <div class="single">
          <span>封面：</span>
          <img src="" alt="">
        </div>
        <div class="single">
          <span>下播时间：</span>
          <p class="style02"></p>
        </div>
        <div class="single">
          <div class="left">
            <span class="style01">最高在线人数：</span>
            <div class="style02"></div>
          </div>
          <div class="right">
            <span class="style01">累计观看人数：</span>
            <div class="style02"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="reco style03">
      <div class="title">
        推荐产品
      </div>
      <div class="cata">
        <button class="active">商品/服务</button>
        <button>优惠券</button>
      </div>
      <div class="product">
        <table>
          <tr class="top">
            <th>类型</th>
            <th>产品ID</th>
            <th>标题</th>
            <th>封面</th>
            <th>原价</th>
            <th>直播价</th>
            <th>推荐后销量</th>
            <th>推荐后点击次数</th>
            <th>开始时间</th>
            <th>结束时间</th>

          </tr>
          <!-- <tr>
            <td>商品</td>
            <td>
              12
            </td>
            <td>宁夏特级黑枸杞...</td>
            <td>
              <img src="../img/demo.jpg" alt="">
            </td>
            <td>
              5454
            </td>
            <td>2121</td>
            <td>2121</td>
            <td>2121</td>
            <td>
              2020-12-12
              15:00:12
            </td>
            <td>
              2020-12-12
              15:00:12
            </td>
  
          </tr> -->

        </table>
        <div class="list-box dn">
          <div class="M-box m-style" id='list01'></div>
          <span class="test03">共100条</span>
        </div>
      </div>
      <div class="no-result product-no dn">
        <img src="../img/history_icon_product@2x.png" alt="">
        <p>暂无推荐产品</p>
      </div>
      <div class="coupon dn">
        <table>
          <tr class="top">
            <th>类型</th>
            <th>产品ID</th>
            <th>优惠金额</th>
            <th>起用金额</th>
            <th>推荐后领取数量</th>
            <th>开始时间</th>
            <th>结束时间</th>

          </tr>
          <!-- <tr>
            <td>商品</td>
            <td>12</td>
            <td>124</td>
            <td>5454</td>
            <td>2121</td>
            <td>
              2020-12-12
              15:00:12
            </td>
            <td>
              2020-12-12
              15:00:12
            </td>

          </tr> -->
        </table>
        <div class="list-box dn">
          <div class="M-box m-style" id='list02'></div>
          <span class="test03">共100条</span>
        </div>
      </div>
      <div class="no-result coupon-no dn">
        <img src="../img/history_icon_yhq@2x.png" alt="">
        <p>暂无推荐优惠券</p>
      </div>

    </div>

    <div class="redpack style03">
      <div class="title">
        红包列表
      </div>
      <table>
        <tr class="top">
          <th>序号</th>
          <th>红包总金额</th>
          <th>红包数量</th>
          <th>派发方式</th>
          <th>已领取人数</th>
          <th>已领取金额</th>
          <th>描述</th>
          <th>开始时间</th>
          <th>结束时间</th>

        </tr>
        <!-- <tr>
          <td>
            12
          </td>
          <td>2020</td>
          <td>
            100
          </td>
          <td>
            平均分配
          </td>
          <td>11</td>
          <td>5454</td>
          <td>这是第一个红包</td>
          <td>
            2020-12-12
            15:00:12
          </td>
          <td>
            2020-12-12
            15:00:12
          </td>

        </tr> -->
      </table>
      <div class="list-box dn">
        <div class="M-box m-style" id='list03'></div>
        <span class="test03">共100条</span>
      </div>
      <div class="no-result redpack-no dn">
        <img src="../img/history_icon_hongbao@2x.png" alt="">
        <p>暂无红包</p>
      </div>
    </div>
  </div>
  <div class="mask dn"></div>

  <div class="footer">
    <span>©2020 广州大健康网络科技有限公司 版权所有</span>
    <p>粤ICP备20014480号-1</p>
  </div>
</body>
<script>
  // $('#list01').pagination({
  //   mode: 'fixed'
  // })
  $('#list02').pagination({
    mode: 'fixed'
  })
  $('#list03').pagination({
    mode: 'fixed'
  })

  //切换商品/优惠券
  $('.cata button').click(function () {
    $('.cata button').removeClass('active')
    $(this).addClass('active')
    if ($(this).index() == 0) {
      $('.coupon').addClass('dn')
      $('.product').removeClass('dn')
    } else {
      $('.coupon').removeClass('dn')
      $('.product').addClass('dn')
    }
  })

  //获取直播历史数据
  var id = getUrlParam('id')
  postRequest('/api/room/get', {
    sessionId: $.cookie('sessionId'),
    id: id
  }, function (res) {
    console.log(res);
    if (res.code == 1) {
      $('.main .content .title').html(res.data.startTime + '场直播数据')
      $('.main .content .info .single').eq(0).children('p').html(res.data.title)
      $('.main .content .info .single').eq(1).children('strong').html(res.data.desc)
      $('.main .content .info .single').eq(2).children('img').attr('src', IMG_URL + res.data.image)
      $('.main .content .info .single').eq(3).children('p').html(res.data.endTime)
      $('.main .content .info .single').eq(4).children('.left').children('div').html(res.data.peakNum + '人')
      $('.main .content .info .single').eq(4).children('.right').children('div').html(res.data.totalNum + '人')
    }

  })


  //获取历史推荐产品
  postRequest('/api/zb/goods/recommendedProduct', {
    pageNumber: 1,
    pageSize: 6,
    roomId: id
  }, function (res) {
    console.log(res);
    if (res.data.list.length == 0) {
      $('.product-no').removeClass('dn')
    } else {
      $('.product .list-box').removeClass('dn')
      $('.product .list-box span').html('共' + res.data.totalRow + '条')
      res.data.list.forEach(function (item, index) {
        for (x in item) {
          console.log(x);
          if (item[x] == null) {
            console.log('我的');
            item[x] = ''
          }
        }
        var type = "商品"
        if (item.type == 1) {
          type = "服务"
        }
        var html = '<tr class="content"><td>' + type + '</td><td>' + item.goodsId + '</td><td>' + item
          .name +
          '</td><td><img src="' +
          IMG_URL + item.image + '" /></td><td>' + item.oldPrice + '</td><td>' + item.price +
          '</td><td>' + item.totalSellCount + '</td><td>' + item.hitCount +
          '</td><td>' + item
          .startTime +
          '</td><td>' + item.endTime +
          '</td><tr>'
        $('.product table').append(html)
      })
      var pageCount = res.data.totalPage
      $('#list01').pagination({
        pageCount: pageCount,
        callback: function (api) {
          var pageNumber = api.getCurrent()
          postRequest('/api/zb/goods/recommendedProduct', {
            pageNumber: pageNumber,
            pageSize: 6,
            roomId: id
          }, function (res) {
            $('.product table .content').remove();
            if (res.code == 1) {
              res.data.list.forEach(function (item, index) {
                for (x in item) {
                  console.log(x);
                  if (item[x] == null) {
                    console.log('我的');
                    item[x] = ''
                  }
                }
                var type = "商品"
                if (item.type == 1) {
                  type = "服务"
                }
                var html = '<tr class="content"><td>' + type + '</td><td>' + item.goodsId +
                  '</td><td>' + item.name + '</td><td><img src="' +
                  IMG_URL + item.image + '" /></td><td>' + item.oldPrice + '</td><td>' + item
                  .price +
                  '</td><td>' + item.totalSellCount +
                  '</td><td>' + item.hitCount + '</td><td>' + item
                  .startTime +
                  '</td><td>' + item.endTime +
                  '</td><tr>'
                $('.product table').append(html)
              })
            }
          })
        }
      })

    }
  })


  //切换商品/优惠券
  $('.cata button').click(function () {
    $('.cata button').removeClass('active')
    $('.product table .content').remove()
    $('.coupon table .content').remove();
    $(this).addClass('active')
    if ($(this).index() == 0) {
      $('.coupon').addClass('dn')
      $('.product').removeClass('dn')
      $('.coupon-no').addClass('dn')
      $('.coupon list-box').addClass('dn')
      //获取正在推荐产品
      postRequest('/api/zb/goods/recommendedProduct', {
        pageNumber: 1,
        pageSize: 6,
        roomId: id
      }, function (res) {
        console.log(res);
        if (res.data.list.length == 0) {
          $('.product-no').removeClass('dn')
        } else {
          $('.product .list-box').removeClass('dn')
          $('.product .list-box span').html('共' + res.data.totalRow + '条')
          res.data.list.forEach(function (item, index) {
            for (x in item) {
          console.log(x);
          if (item[x] == null) {
            console.log('我的');
            item[x] = ''
          }
        }
            var type = "商品"
            if (item.type == 1) {
              type = "服务"
            }
            var html = '<tr class="content"><td>' + type + '</td><td>' + item.goodsId +
              '</td><td>' + item
              .name +
              '</td><td><img src="' +
              IMG_URL + item.image + '" /></td><td>' + item.oldPrice + '</td><td>' + item.price +
              '</td><td>' + item.totalSellCount + '</td><td>' + item.hitCount +
              '</td><td>' + item
              .startTime +
              '</td><td>' + item.endTime +
              '</td><tr>'
            $('.product table').append(html)
          })
          var pageCount = res.data.totalPage
          $('#list01').pagination({
            pageCount: pageCount,
            callback: function (api) {
              var pageNumber = api.getCurrent()
              postRequest('/api/zb/goods/recommendedProduct', {
                pageNumber: pageNumber,
                pageSize: 6,
                roomId: id
              }, function (res) {
                $('.product table .content').remove();
                if (res.code == 1) {
                  res.data.list.forEach(function (item, index) {
                    for (x in item) {
          console.log(x);
          if (item[x] == null) {
            console.log('我的');
            item[x] = ''
          }
        }
                    var type = "商品"
                    if (item.type == 1) {
                      type = "服务"
                    }
                    var html = '<tr class="content"><td>' + type + '</td><td>' + item
                      .goodsId +
                      '</td><td>' + item.name + '</td><td><img src="' +
                      IMG_URL + item.image + '" /></td><td>' + item.oldPrice +
                      '</td><td>' +
                      item
                      .price +
                      '</td><td>' + item.totalSellCount +
                      '</td><td>' + item.hitCount + '</td><td>' + item
                      .startTime +
                      '</td><td>' + item.endTime +
                      '</td><tr>'
                    $('.product table').append(html)
                  })
                }
              })
            }
          })


        }
      })
    } else {
      $('.coupon').removeClass('dn')
      $('.product').addClass('dn')
      $('.product-no').addClass('dn')
      $('.product list-box').addClass('dn')
      postRequest('/api/zb/coupon/recommendedCoupon', {
        pageNumber: 1,
        pageSize: 6,
        roomId: id
      }, function (res) {
        console.log(res);
        if (res.data.list.length == 0) {
          $('.coupon-no').removeClass('dn')
        } else {
          $('.coupon .list-box').removeClass('dn')
          $('.coupon .list-box span').html('共' + res.data.totalRow + '条')
          res.data.list.forEach(function (item, index) {
            for (x in item) {
          console.log(x);
          if (item[x] == null) {
            console.log('我的');
            item[x] = ''
          }
        }
            var html = '<tr class="content"><td>优惠券</td><td>' + item.couponId + '</td><td>' + item
              .count +
              '</td><td>' +
              item.limitCount + '</td><td>' + item.receivedCount + '</td><td>' +
              item
              .startTime +
              '</td><td>' + item.endTime +
              '</td><tr>'
            $('.coupon table').append(html)
          })
          var pageCount = res.data.totalPage
          $('#list02').pagination({
            pageCount: pageCount,
            callback: function (api) {
              var pageNumber = api.getCurrent()
              postRequest('/api/zb/coupon/recommendedCoupon', {
                pageNumber: 1,
                pageSize: 6,
              }, function (res) {
                $('.coupon table .content').remove();
                if (res.code == 1) {
                  res.data.list.forEach(function (item, index) {
                    for (x in item) {
          console.log(x);
          if (item[x] == null) {
            console.log('我的');
            item[x] = ''
          }
        }
                    var html = '<tr class="content"><td>优惠券</td><td>' + item.couponId +
                      '</td><td>' + item
                      .count +
                      '</td><td>' +
                      item.limitCount + '</td><td>' + item.receivedCount + '</td><td>' +
                      item
                      .startTime +
                      '</td><td>' + item.endTime +
                      '</td><tr>'
                    $('.coupon table').append(html)
                  })
                }
              })
            }
          })


        }
      })
    }
  })


  //获取正在发送红包
  postRequest('/api/zb/red/recommendedRed', {
    pageNumber: 1,
    pageSize: 6,
    roomId: id
  }, function (res) {
    console.log(res);
    if (res.data.list.length == 0) {
      $('.redpack-no').removeClass('dn')
    } else {
      $('.redpack .list-box').removeClass('dn')
      $('.redpack .list-box span').html('共' + res.data.totalRow + '条')
      res.data.list.forEach(function (item, index) {
        for (x in item) {
          console.log(x);
          if (item[x] == null) {
            console.log('我的');
            item[x] = ''
          }
        }
        if (item.state == 0) {
          var html = '<tr class="content"><td>' + item.id + '</td><td>' + item.amount + '</td><td>' +
            item.num + '</td><td>' + item.mold + '</td><td>' + item.receivedCount + '</td><td>' + item
            .receivedMoney + '</td><td>' + item.desc + '</td><td>' + item.startTime + '</td><td>' + item
            .endTime +
            '</td></tr>"'

        } else if (item.state == 1) {
          var html = '<tr class="content"><td>' + item.id + '</td><td>' + item.amount + '</td><td>' +
            item.num + '</td><td>' + item.mold + '</td><td>' + item.receivedCount + '</td><td>' + item
            .receivedMoney + '</td><td>' + item.desc + '</td><td>' + item.startTime + '</td><td>' + item
            .endTime +
            '</td></tr>"'

        } else {
          var html = '<tr class="content"><td>' + item.id + '</td><td>' + item.amount + '</td><td>' +
            item.num + '</td><td>' + item.mold + '</td><td>' + item.receivedCount + '</td><td>' + item
            .receivedMoney + '</td><td>' + item.desc + '</td><td>' + item.startTime + '</td><td>' + item
            .endTime + '</td></tr>"'

        }
        $('.redpack table').append(html)
      })
      var pageCount = res.data.totalPage
      $('#list03').pagination({
        pageCount: pageCount,
        callback: function (api) {
          var pageNumber = api.getCurrent()
          postRequest('/api/zb/red/recommendedRed', {
            pageNumber: pageNumber,
            pageSize: 6,
            roomId: id
          }, function (res) {
            $('.redpack table .content').remove();
            if (res.code == 1) {
              res.data.list.forEach(function (item, index) {
                for (x in item) {
          console.log(x);
          if (item[x] == null) {
            console.log('我的');
            item[x] = ''
          }
        }
                if (item.state == 0) {
                  var html = '<tr class="content"><td>' + item.id + '</td><td>' + item
                    .amount + '</td><td>' +
                    item.num + '</td><td>' + item.mold + '</td><td>' + item.receivedCount +
                    '</td><td>' + item
                    .receivedMoney + '</td><td>' + item.desc + '</td><td>' + item.startTime +
                    '</td><td>' + item
                    .endTime +
                    '</td></tr>"'

                } else if (item.state == 1) {
                  var html = '<tr class="content"><td>' + item.id + '</td><td>' + item
                    .amount + '</td><td>' +
                    item.num + '</td><td>' + item.mold + '</td><td>' + item.receivedCount +
                    '</td><td>' + item
                    .receivedMoney + '</td><td>' + item.desc + '</td><td>' + item.startTime +
                    '</td><td>' + item
                    .endTime +
                    '</td></tr>"'

                } else {
                  var html = '<tr class="content"><td>' + item.id + '</td><td>' + item
                    .amount + '</td><td>' +
                    item.num + '</td><td>' + item.mold + '</td><td>' + item.receivedCount +
                    '</td><td>' + item
                    .receivedMoney + '</td><td>' + item.desc + '</td><td>' + item.startTime +
                    '</td><td>' + item
                    .endTime + '</td></tr>"'

                }
                $('.redpack table').append(html)
              })
            }
          })
        }
      })
    }
  })
</script>

</html>